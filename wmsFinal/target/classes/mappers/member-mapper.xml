<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<resultMap type="member" id="memberResultSet">
		<result column="MEMBER_NO" property="memberNo"/>	
		<result column="MEMBER_ID" property="memberId"/>	
		<result column="MEMBER_PWD" property="memberPwd"/>	
		<result column="MEMBER_NAME" property="memberName"/>	
		<result column="EMAIL" property="email"/>	
		<result column="GENDER" property="gender"/>	
		<result column="PHONE" property="phone"/>	
		<result column="MEMBER_STATUS" property="memberStatus"/>	
		<result column="MARK" property="mark"/>	
		<result column="BIRTH_DATE" property="birthDate"/>	
		<result column="POINT" property="point"/>	
		<result column="PLATFORM" property="platForm"/>	
		<result column="AUTHKEY" property="authKey"/>	
	</resultMap>
	
	<resultMap id="paymentResultSet" type = "payment">
		<result column="PAYMENT_NO" property="paymentNo"/>
		<result column="MEMBER_NO" property="memberNo"/>
		<result column="MARK_NO" property="markNo"/>
		<result column="PAYMENT_DATE" property="paymentDate"/>
		<result column="PAYMENT_METHOD" property="paymentMethod"/>
	</resultMap>
	
		<resultMap type="team" id="teamMemberResultSet">
		<result column="TEAM_NO" property="teamNo"/>
		<result column="SPORTS_NO" property="sportsNo"/>
		<result column="TEAM_NAME" property="teamName"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="WIN_COUNT" property="winCount"/>
		<result column="DRAW_COUNT" property="drawCount"/>
		<result column="LOSE_COUNT" property="loseCount"/>
		<result column="WIN_POINT" property="winPoint"/>
		<result column="TEAM_INTRO" property="teamIntro"/>
		<result column="TEAM_STATUS" property="teamStatus"/>
		<result column="ADDRESS_NO" property="addressNo"/>
		<result column="SIDO_NAME" property="sidoName"/>
		<result column="SIGUNGU_NAME" property="siGunGuName"/>
		<result column="SPORTS_NAME" property="sportsName"/>
		<result column="ORIGIN_NAME" property="logoOriginName"/>
		<result column="CHANGE_NAME" property="logoChangeName"/>
		<result column="BOSS_ID" property="bossId"/>
		<result column="rNum" property="rowNum"/>
		

	</resultMap>
	
	
	
	<select id="ajaxCheckId" resultType="_int" parameterType="String">
		
		SELECT COUNT(*) FROM MEMBER
		WHERE MEMBER_ID = #{memberId}
		
	</select>
	
	<select id="ajaxAuthEmail" resultType="_int" parameterType="String">
		
		SELECT COUNT(*) FROM MEMBER
		WHERE EMAIL = #{email}
		
	</select>
	
	<select id="loginMemberAuth" resultMap="memberResultSet" parameterType="String">
		
		SELECT * FROM MEMBER
		WHERE AUTHKEY = #{authKey}
		AND MEMBER_STATUS = 'Y'
	</select>
	
	<select id="AjaxPlatFormCheck" resultType="_int" parameterType="String">
		
		SELECT COUNT(*) FROM MEMBER
		WHERE AUTHKEY = #{authKey}
		AND MEMBER_STATUS = 'Y'
	</select>
	
	
	<insert id="insertMember" parameterType="member">
		
		INSERT INTO 
		MEMBER
		(MEMBER_NO, MEMBER_ID, MEMBER_PWD, MEMBER_NAME, EMAIL, PHONE, BIRTH_DATE, PLATFORM, AUTHKEY)
		VALUES
		(SEQ_MNO.NEXTVAL, #{memberId}, #{memberPwd}, #{memberName}, #{email}, #{phone}, #{birthDate}, #{platForm}, #{authKey})
		
	</insert>
	
	<select id="loginMember" parameterType="member" resultMap="memberResultSet">
	
		SELECT * FROM MEMBER 
		WHERE MEMBER_ID = #{memberId}
		AND MEMBER_STATUS = 'Y'
	
	</select>
	
	
	<!-- 관민존 -->
	<select id="selectMyTeamCount" parameterType="member" resultType="_int">
	
	    SELECT COUNT(*)
	    FROM MEMBER_TEAM
	    JOIN TEAM T USING(TEAM_NO)
	    JOIN MEMBER USING(MEMBER_NO)
	    WHERE MEMBER_ID = #{memberId}
    	AND TEAM_STATUS = 'Y'
	    
	</select>
	
	<select id="selectmyJoinTeamList" parameterType="member" resultMap="teamMemberResultSet">
	
    SELECT T.TEAM_NAME, T.SPORTS_NAME, ROWNUM rNum,T.TEAM_NO
    FROM 
    (
        SELECT *
        FROM MEMBER_TEAM
        JOIN TEAM T USING(TEAM_NO)
        JOIN MEMBER USING(MEMBER_NO)
        WHERE MEMBER_ID = #{memberId}
        AND TEAM_STATUS = 'Y'
        ORDER BY TEAM_NO DESC
    )T
	
	</select>
	
	<delete id="quitTeam" parameterType="HashMap">
	
	DELETE FROM MEMBER_TEAM
	WHERE TEAM_NO = #{teamNo}
	AND MEMBER_NO = #{memberNo}
	</delete>
	
	<select id="selectTeam" parameterType="_int" resultMap="teamMemberResultSet">
	
		SELECT 
		    WIN_POINT
		    ,WIN_COUNT
		    ,TEAM_STATUS
		    ,TEAM_NO
		    ,TEAM_NAME
		    ,TEAM_INTRO
		    ,SPORTS_NAME
		    ,SIGUNGU_NAME
		    ,SIDO_NAME
		    ,ORIGIN_NAME
		    ,LOSE_COUNT
		    ,DRAW_COUNT
		    ,SUBSTR(CREATE_DATE, 1,10) CREATE_DATE
		    ,CHANGE_NAME
		    ,BOSS_ID
		FROM TEAM
		WHERE TEAM_NO = #{teamNo}
	
	</select>
	
	<select id="selectMyCreateTeamCount" parameterType="member" resultType="_int">
	
		SELECT COUNT(*)
		FROM TEAM
		WHERE BOSS_ID = #{memberId}
	
	</select>
	
	<select id="selectListCreateTeam" parameterType="member" resultMap="teamMemberResultSet" resultType="arraylist">
		
		SELECT 
		    WIN_POINT
		    ,WIN_COUNT
		    ,TEAM_STATUS
		    ,TEAM_NO
		    ,TEAM_NAME
		    ,TEAM_INTRO
		    ,SPORTS_NAME
		    ,SIGUNGU_NAME
		    ,SIDO_NAME
		    ,ORIGIN_NAME
		    ,LOSE_COUNT
		    ,DRAW_COUNT
		    ,SUBSTR(CREATE_DATE, 1,10) CREATE_DATE
		    ,CHANGE_NAME
		    ,BOSS_ID
		FROM TEAM
		WHERE BOSS_ID = #{memberId}
	
	</select>
	
	<update id="updateTeam">
	
		UPDATE TEAM
		    SET 
		    TEAM_NAME = #{teamName},
		    SPORTS_NAME = #{sportsName},
		    TEAM_INTRO = #{teamIntro},
		    SIDO_NAME = #{sidoName},
		    SIGUNGU_NAME = #{siGunGuName},
		    ORIGIN_NAME = #{logoOriginName},
		    CHANGE_NAME = #{logoChangeName}
		WHERE 
			TEAM_NO = #{teamNo}
			
	</update>
	
	

</mapper>
